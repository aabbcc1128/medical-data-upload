<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุงูุชุญูู - ููุตุฉ ุฑูุน ุงูุจูุงูุงุช</title>
    <link href="output.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body { font-family: 'Amiri', sans-serif; background-color: #f5f7fa; margin: 0; }
        .main-content { padding: 1rem; }
        .header { display: flex; justify-content: space-between; align-items: center; background-color: #fff; padding: 0.5rem 1rem; border-bottom: 1px solid #dee2e6; }
        .logo { height: 40px; }
        .nav-actions { display: flex; align-items: center; gap: 1rem; }
        .filter-section { background-color: #fff; padding: 1rem; border-radius: 4px; margin-bottom: 1rem; }
        .filter-section label { margin-left: 0.5rem; }
        .filter-section select, .filter-section input { padding: 0.25rem; width: 100%; margin-bottom: 0.5rem; }
        .input-section { background-color: #fff; padding: 1rem; border-radius: 4px; margin-bottom: 1rem; }
        .input-section label { margin-left: 0.5rem; }
        .input-section input, .input-section select { padding: 0.25rem; width: 100%; margin-bottom: 0.5rem; }
        .table-container { background-color: #fff; padding: 1rem; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.5rem; text-align: right; border-bottom: 1px solid #dee2e6; }
        th { background-color: #f8f9fa; }
        .action-btn { background-color: #28a745; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; text-decoration: none; margin-left: 0.25rem; }
        .details-modal, .calendar-modal { display: none; position: fixed; top: 0; right: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); }
        .details-content, .calendar-content { background-color: #fff; margin: 5% auto; padding: 1rem; border-radius: 4px; width: 80%; max-width: 600px; }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="header">
            <img src="assets/brandLogo.23c31b2e.svg" alt="Brand Logo" class="logo">
            <div class="nav-actions">
                <div class="flex gap-2">
                    <a href="#" class="action-btn" id="calendarBtn">๐</a>
                    <a href="#" class="action-btn">๐</a>
                    <a href="#" class="action-btn">+</a>
                </div>
                <a href="#" class="text-blue-500">ุงููุบุฉ</a>
                <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">A</div>
                <button id="logoutBtn" class="bg-red-500 text-white px-4 py-1 rounded">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
            </div>
        </div>

        <div id="adminView" style="display: none;">
            <h2>ููุญุฉ ุงูุชุญูู - ุนุฑุถ ุงููุฏูุฑ</h2>
            <div class="filter-section">
                <h3>ุฅุฏุฑุงุฌ ุงูุฅุฑุณุงูุงุช: <span id="totalEntriesAdmin">0</span></h3>
                <label>ุชุญููู ููู CSV</label>
                <input type="file" id="fileInputAdmin" accept=".csv">
                <label>ุงูููุทูุฉ *</label>
                <select id="regionFilterAdmin">
                    <option value="">ุงุฎุชุฑ ุงูููุทูุฉ</option>
                    <option value="ููู">ููู</option>
                    <option value="ุนุฑูุงุช">ุนุฑูุงุช</option>
                    <option value="ูุฒุฏููุฉ">ูุฒุฏููุฉ</option>
                </select>
                <label>ุงููุณุชุดูู *</label>
                <select id="hospitalFilterAdmin">
                    <option value="">ุงุฎุชุฑ ุงููุณุชุดูู</option>
                    <option value="ููุงู ุฃุญูุฑ">ููุงู ุฃุญูุฑ</option>
                    <option value="ุงูุญุฑุณ ุงููุทูู">ุงูุญุฑุณ ุงููุทูู</option>
                    <option value="ูุฒุงุฑุฉ ุงูุฏูุงุน">ูุฒุงุฑุฉ ุงูุฏูุงุน</option>
                    <option value="ูุณุชุดูู ูููุฉ">ูุณุชุดูู ูููุฉ</option>
                    <option value="ุงููุทุงุน ุงูุฎุงุต">ุงููุทุงุน ุงูุฎุงุต</option>
                    <option value="ูุณุชุดูู ููู ุงูุฃูู">ูุณุชุดูู ููู ุงูุฃูู</option>
                </select>
                <button id="resetFiltersAdmin" class="bg-green-500 text-white px-4 py-1 rounded mt-2">ุฅุนุงุฏุฉ ุชุนููู ุงููู</button>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ุงูููุทูุฉ</th>
                            <th>ุงููุณุชุดูู</th>
                            <th>ุงุณู ุงููุณุชุฎุฏู</th>
                            <th>ุชุงุฑูุฎ ุงูุฅุฑุณุงู</th>
                            <th>ุงูุฅุฌุฑุงุก</th>
                        </tr>
                    </thead>
                    <tbody id="submissionTableAdmin"></tbody>
                </table>
            </div>
        </div>

        <div id="userView">
            <h2>ููุญุฉ ุงูุชุญูู - ุฅุฏุฎุงู ุจูุงูุงุช</h2>
            <div class="input-section">
                <h3>ุฅุฏุฎุงู ุจูุงูุงุช ุฌุฏูุฏุฉ</h3>
                <label>ุงูููุทูุฉ *</label>
                <select id="regionInput">
                    <option value="">ุงุฎุชุฑ ุงูููุทูุฉ</option>
                    <option value="ููู">ููู</option>
                    <option value="ุนุฑูุงุช">ุนุฑูุงุช</option>
                    <option value="ูุฒุฏููุฉ">ูุฒุฏููุฉ</option>
                </select>
                <label>ุงููุณุชุดูู *</label>
                <select id="hospitalInput">
                    <option value="">ุงุฎุชุฑ ุงููุณุชุดูู</option>
                    <option value="ููุงู ุฃุญูุฑ">ููุงู ุฃุญูุฑ</option>
                    <option value="ุงูุญุฑุณ ุงููุทูู">ุงูุญุฑุณ ุงููุทูู</option>
                    <option value="ูุฒุงุฑุฉ ุงูุฏูุงุน">ูุฒุงุฑุฉ ุงูุฏูุงุน</option>
                    <option value="ูุณุชุดูู ูููุฉ">ูุณุชุดูู ูููุฉ</option>
                    <option value="ุงููุทุงุน ุงูุฎุงุต">ุงููุทุงุน ุงูุฎุงุต</option>
                    <option value="ูุณุชุดูู ููู ุงูุฃูู">ูุณุชุดูู ููู ุงูุฃูู</option>
                </select>
                <label>ุงุณู ุงููุณุชุฎุฏู *</label>
                <input type="text" id="usernameInput" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู" readonly>
                <label>ุชุงุฑูุฎ ุงูุฅุฑุณุงู *</label>
                <input type="date" id="dateInput">
                <button id="submitEntryBtn" class="bg-blue-500 text-white px-4 py-1 rounded mt-2">ุฅุฑุณุงู</button>
                <label>ุชุญููู ููู CSV</label>
                <input type="file" id="fileInputUser" accept=".csv">
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ุงูููุทูุฉ</th>
                            <th>ุงููุณุชุดูู</th>
                            <th>ุงุณู ุงููุณุชุฎุฏู</th>
                            <th>ุชุงุฑูุฎ ุงูุฅุฑุณุงู</th>
                            <th>ุงูุฅุฌุฑุงุก</th>
                        </tr>
                    </thead>
                    <tbody id="submissionTableUser"></tbody>
                </table>
            </div>
        </div>

        <div id="detailsModal" class="details-modal">
            <div class="details-content">
                <h3>ุชูุงุตูู ุงูุฅุฑุณุงู</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ุงูููุทูุฉ</th>
                            <th>ุงููุณุชุดูู</th>
                            <th>ุงุณู ุงููุณุชุฎุฏู</th>
                            <th>ุชุงุฑูุฎ ุงูุฅุฑุณุงู</th>
                        </tr>
                    </thead>
                    <tbody id="detailsTable"></tbody>
                </table>
                <button onclick="closeDetails()">ุฅุบูุงู</button>
            </div>
        </div>

        <div id="calendarModal" class="calendar-modal">
            <div class="calendar-content">
                <h3>ุฅุฏุฎุงู ุจูุงูุงุช ุฌุฏูุฏุฉ</h3>
                <label>ุงูููุทูุฉ *</label>
                <select id="calendarRegionInput">
                    <option value="">ุงุฎุชุฑ ุงูููุทูุฉ</option>
                    <option value="ููู">ููู</option>
                    <option value="ุนุฑูุงุช">ุนุฑูุงุช</option>
                    <option value="ูุฒุฏููุฉ">ูุฒุฏููุฉ</option>
                </select>
                <label>ุงููุณุชุดูู *</label>
                <select id="calendarHospitalInput">
                    <option value="">ุงุฎุชุฑ ุงููุณุชุดูู</option>
                    <option value="ููุงู ุฃุญูุฑ">ููุงู ุฃุญูุฑ</option>
                    <option value="ุงูุญุฑุณ ุงููุทูู">ุงูุญุฑุณ ุงููุทูู</option>
                    <option value="ูุฒุงุฑุฉ ุงูุฏูุงุน">ูุฒุงุฑุฉ ุงูุฏูุงุน</option>
                    <option value="ูุณุชุดูู ูููุฉ">ูุณุชุดูู ูููุฉ</option>
                    <option value="ุงููุทุงุน ุงูุฎุงุต">ุงููุทุงุน ุงูุฎุงุต</option>
                    <option value="ูุณุชุดูู ููู ุงูุฃูู">ูุณุชุดูู ููู ุงูุฃูู</option>
                </select>
                <label>ุงุณู ุงููุณุชุฎุฏู *</label>
                <input type="text" id="calendarUsernameInput" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู" readonly>
                <label>ุชุงุฑูุฎ ุงูุฅุฑุณุงู *</label>
                <input type="date" id="calendarDateInput">
                <button id="calendarSubmitBtn" class="bg-blue-500 text-white px-4 py-1 rounded mt-2">ุฅุฑุณุงู</button>
                <button onclick="closeCalendar()">ุฅุบูุงู</button>
            </div>
        </div>

        <p class="text-sm text-gray-500 mt-2">ูุฏุนูู ูู MOH</p>
    </div>

    <script>
        // ุงูุชุญูู ูู ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู
        if (!localStorage.getItem('isAuthenticated')) {
            alert("ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู!");
            window.location.href = "index.html";
        }

        // ุชุญุฏูุฏ ุงูุฏูุฑ ูุงุณู ุงููุณุชุฎุฏู
        let userRole = localStorage.getItem('userRole') || 'User';
        let username = localStorage.getItem('username') || 'admin@example.com';

        // ุนุฑุถ ุงููุงุฌูุฉ ุจูุงุกู ุนูู ุงูุฏูุฑ
        const adminView = document.getElementById('adminView');
        const userView = document.getElementById('userView');
        if (userRole === 'Admin') {
            adminView.style.display = 'block';
            userView.style.display = 'none';
        } else {
            adminView.style.display = 'none';
            userView.style.display = 'block';
            document.getElementById('usernameInput').value = username;
            document.getElementById('calendarUsernameInput').value = username;
        }

        // ุชุญููู ุงูุจูุงูุงุช ูู localStorage
        let entries = JSON.parse(localStorage.getItem('entries')) || [];

        // ุฏุงูุฉ ูุชุญุฏูุซ ุฌุฏูู ุงูุฅุฏุฎุงูุงุช
        function updateTable(tbodyId, filterRole = null) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';
            let filteredEntries = entries;

            // ุชุตููุฉ ุจูุงุกู ุนูู ุงูุฏูุฑ
            if (filterRole === 'User') {
                filteredEntries = entries.filter(entry => entry.username === username);
            }

            // ุชุตููุฉ ุจูุงุกู ุนูู ุงูููุงุชุฑ (ูููุฏูุฑ ููุท)
            if (tbodyId === 'submissionTableAdmin') {
                const regionFilter = document.getElementById('regionFilterAdmin').value;
                const hospitalFilter = document.getElementById('hospitalFilterAdmin').value;
                if (regionFilter) {
                    filteredEntries = filteredEntries.filter(entry => entry.region === regionFilter);
                }
                if (hospitalFilter) {
                    filteredEntries = filteredEntries.filter(entry => entry.hospital === hospitalFilter);
                }
            }

            filteredEntries.forEach(entry => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${entry.region}</td>
                    <td>${entry.hospital}</td>
                    <td>${entry.username}</td>
                    <td>${entry.date}</td>
                    <td><button class="action-btn" onclick="showDetails(this)">๐๏ธ</button></td>
                `;
                tbody.appendChild(tr);
            });

            // ุชุญุฏูุซ ุนุฏุฏ ุงูุฅุฏุฎุงูุงุช
            const totalEntries = filteredEntries.length;
            document.getElementById(tbodyId === 'submissionTableAdmin' ? 'totalEntriesAdmin' : 'totalEntriesUserFooter').textContent = totalEntries;
        }

        // ุชุญุฏูุซ ุงูุฌุฏุงูู ุนูุฏ ุงูุชุญููู
        updateTable('submissionTableAdmin');
        updateTable('submissionTableUser', 'User');

        // ุฅุถุงูุฉ ุฅุฏุฎุงู ุฌุฏูุฏ ูู ุงููููุฐุฌ ุงูุฃุณุงุณู
        document.getElementById('submitEntryBtn').addEventListener('click', () => {
            const region = document.getElementById('regionInput').value;
            const hospital = document.getElementById('hospitalInput').value;
            const date = document.getElementById('dateInput').value;
            if (!region || !hospital || !date) {
                alert('ูุฑุฌู ููุก ุฌููุน ุงูุญููู!');
                return;
            }
            const newEntry = { region, hospital, username, date };
            entries.push(newEntry);
            localStorage.setItem('entries', JSON.stringify(entries));
            updateTable('submissionTableAdmin');
            updateTable('submissionTableUser', 'User');
            alert('ุชู ุฅุถุงูุฉ ุงูุฅุฏุฎุงู ุจูุฌุงุญ!');
        });

        // ุฅุถุงูุฉ ุฅุฏุฎุงู ุฌุฏูุฏ ูู ุงููููุฐุฌ ุงูููุจุซู
        document.getElementById('calendarSubmitBtn').addEventListener('click', () => {
            const region = document.getElementById('calendarRegionInput').value;
            const hospital = document.getElementById('calendarHospitalInput').value;
            const date = document.getElementById('calendarDateInput').value;
            if (!region || !hospital || !date) {
                alert('ูุฑุฌู ููุก ุฌููุน ุงูุญููู!');
                return;
            }
            const newEntry = { region, hospital, username, date };
            entries.push(newEntry);
            localStorage.setItem('entries', JSON.stringify(entries));
            updateTable('submissionTableAdmin');
            updateTable('submissionTableUser', 'User');
            closeCalendar();
            alert('ุชู ุฅุถุงูุฉ ุงูุฅุฏุฎุงู ุจูุฌุงุญ!');
        });

        // ุชุญููู ููู CSV
        function handleCSVUpload(fileInputId, callback) {
            const fileInput = document.getElementById(fileInputId);
            const file = fileInput.files[0];
            if (!file) {
                alert('ูุฑุฌู ุงุฎุชูุงุฑ ููู CSV');
                return;
            }
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    const data = results.data;
                    data.forEach(row => {
                        if (row['ุงูููุทูุฉ'] && row['ุงููุณุชุดูู'] && row['ุงุณู ุงููุณุชุฎุฏู'] && row['ุชุงุฑูุฎ ุงูุฅุฑุณุงู']) {
                            entries.push({
                                region: row['ุงูููุทูุฉ'],
                                hospital: row['ุงููุณุชุดูู'],
                                username: row['ุงุณู ุงููุณุชุฎุฏู'],
                                date: row['ุชุงุฑูุฎ ุงูุฅุฑุณุงู']
                            });
                        }
                    });
                    localStorage.setItem('entries', JSON.stringify(entries));
                    callback();
                    alert('ุชู ุชุญููู ููู CSV ุจูุฌุงุญ!');
                },
                error: function(error) {
                    alert('ุฎุทุฃ ูู ุชุญููู ููู CSV: ' + error.message);
                }
            });
        }

        document.getElementById('fileInputAdmin').addEventListener('change', () => {
            handleCSVUpload('fileInputAdmin', () => {
                updateTable('submissionTableAdmin');
                updateTable('submissionTableUser', 'User');
            });
        });

        document.getElementById('fileInputUser').addEventListener('change', () => {
            handleCSVUpload('fileInputUser', () => {
                updateTable('submissionTableAdmin');
                updateTable('submissionTableUser', 'User');
            });
        });

        // ุชุทุจูู ุงูููุงุชุฑ
        document.getElementById('regionFilterAdmin').addEventListener('change', () => updateTable('submissionTableAdmin'));
        document.getElementById('hospitalFilterAdmin').addEventListener('change', () => updateTable('submissionTableAdmin'));
        document.getElementById('resetFiltersAdmin').addEventListener('click', () => {
            document.getElementById('regionFilterAdmin').value = '';
            document.getElementById('hospitalFilterAdmin').value = '';
            updateTable('submissionTableAdmin');
        });

        // ุนุฑุถ ุงูุชูุงุตูู
        function showDetails(button) {
            const row = button.closest('tr');
            const region = row.cells[0].textContent;
            const hospital = row.cells[1].textContent;
            const username = row.cells[2].textContent;
            const date = row.cells[3].textContent;

            const detailsTable = document.getElementById('detailsTable');
            detailsTable.innerHTML = `
                <tr>
                    <td>${region}</td>
                    <td>${hospital}</td>
                    <td>${username}</td>
                    <td>${date}</td>
                </tr>
            `;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function closeDetails() {
            document.getElementById('detailsModal').style.display = 'none';
        }

        // ุนุฑุถ ูุฅุบูุงู ุงููููุฐุฌ ุงูููุจุซู ููุชูููู
        document.getElementById('calendarBtn').addEventListener('click', () => {
            document.getElementById('calendarModal').style.display = 'block';
            document.getElementById('calendarUsernameInput').value = username;
        });

        function closeCalendar() {
            document.getElementById('calendarModal').style.display = 'none';
            document.getElementById('calendarRegionInput').value = '';
            document.getElementById('calendarHospitalInput').value = '';
            document.getElementById('calendarDateInput').value = '';
        }

        // ุชุณุฌูู ุงูุฎุฑูุฌ
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('isAuthenticated');
            localStorage.removeItem('userRole');
            localStorage.removeItem('username');
            localStorage.removeItem('entries');
            window.location.href = "index.html";
        });
    </script>
</body>
</html>
